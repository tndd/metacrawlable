# アンチクローラー機構

各サイトは、クローラーの回復力の異なる側面をテストするために、特定のアンチクローラー機能を実装します。

## 実装要件

| 機能                     | 適用対象      | 実装要件                                                          |
| ------------------------ | ------------- | ----------------------------------------------------------------------- |
| JavaScript専用コンテンツ    | `client-only` | `useEffect()`を使用してロード後にコンテンツをレンダリング。SSR出力は空。    |
| SSR + DOMランダム化     | `dynamic`     | ロード毎に乱数生成 + DOMシャッフル。                                  |
| ボットミドルウェア         | `anti-bot`    | `middleware.ts`を使用してヘッダーを検査し、既知ボットUAをブロック。        |
| サイトマップ汚染          | `trap-broken` | sitemap.xmlに意図的に存在しないページを含める。                    |
| 再帰的リンクトラップ     | `trap/[slug]` | スラッグはさらなるスラッグにリンクし、無限ナビゲーションループを形成。  |
| メタデータ不一致        | `meta-fake`   | HTMLコンテンツはheadメタデータと大きく異なる必要がある。            |
| robots.txt不一致       | varies        | 一部のパスは明示的に禁止、他は全く言及されない。                       |

これらの動作からの逸脱はすべて**重大なエラー**とみなされなければなりません。

## テスト戦略

### JavaScript実行テスト
- サーバーサイドコンテンツがないページ
- 動的コンテンツインジェクション
- マップレンダリング要件

### User-Agent検出
- ミドルウェアベースのブロッキング
- User-Agent毎の異なるレスポンス
- ヘッダー検査とフィルタリング

### 構造的課題
- 変化するDOMレイアウト
- 動的クラス名とID
- ランダム化されたコンテンツ配置

### ナビゲーショントラップ
- 無限再帰パス
- ブロークンリンクハンドリング
- 誤解を招くサイトマップエントリ

### メタデータ不一致
- 偽のメタ説明
- 誤解を招くJSON-LDスキーマ
- タイトル/コンテンツの不一致